<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Products - STUDIO AKIRA</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>

<body>
    <!-- Navigation -->
    <!-- Navigation - Updated Structure -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-left">
                <a href="index.html" class="navbar-logo">studio akira</a>
            </div>
            <ul class="navbar-menu">
                <li><a href="index.html" class="navbar-link">Home</a></li>
                <li><a href="#" onclick="requireLogin('collections'); return false;" class="navbar-link">Collections</a>
                </li>
                <li><a href="about.html" class="navbar-link">About</a></li>
                <li><a href="contact.html" class="navbar-link">Contact</a></li>
                <li><a href="#" onclick="requireLogin('orders'); return false;" class="navbar-link">Orders</a></li>
            </ul>
            <div class="navbar-right">
                <a href="#" onclick="requireLogin('cart'); return false;" class="navbar-icon" title="Cart">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                </a>
                <div class="navbar-profile-dropdown">
                    <button class="navbar-icon" onclick="toggleProfileMenu(event)" title="Profile">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </button>
                    <div class="profile-dropdown-menu" id="profileMenu">
                        <a href="#" onclick="requireLogin('profile'); return false;">Profile</a>
                        <a href="#" onclick="openLoginModal(); return false;">Login</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Products Section -->
    <section class="section" style="padding-top: 100px;">
        <div class="container">
            <h1 class="section-title">Our Collection</h1>
            <p class="section-subtitle text-center">Explore all our handcrafted natural candles</p>

            <!-- Filter Options -->
            <div class="flex justify-center gap-md mb-lg" style="flex-wrap: wrap;">
                <button class="btn btn-outline-primary" onclick="filterProducts('all')">All Products</button>
                <button class="btn btn-outline-primary" onclick="filterProducts('signature')">Signature Candles</button>
                <button class="btn btn-outline-primary" onclick="filterProducts('ritual')">Ritual / Spiritual
                    Candles</button>
                <button class="btn btn-outline-primary" onclick="filterProducts('luxury')">Luxury Gift Boxes</button>
            </div>

            <div id="products-grid" class="grid grid-4 gap-lg">
                <div class="text-center" style="grid-column: 1/-1;">Loading products...</div>
            </div>
        </div>
    </section>

    <!-- Login Modal (same as index.html) -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeLoginModal()">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title">Welcome</h2>
            </div>
            <div class="modal-body">
                <div id="roleSelection">
                    <p class="text-center mb-md">Select your role to continue</p>
                    <div class="grid grid-2 gap-md">
                        <button class="btn btn-primary" onclick="selectRole('customer')">Customer</button>
                        <button class="btn btn-secondary" onclick="selectRole('admin')">Admin</button>
                    </div>
                    <div class="text-center mt-md">
                        <p style="margin-bottom: var(--spacing-sm); color: var(--color-gray);">First time here?</p>
                        <button class="btn btn-outline-primary" style="width: 100%;" onclick="showSignupForm()">Create
                            New Account</button>
                    </div>
                </div>
                <form id="loginForm" class="hidden">
                    <input type="hidden" id="selectedRole">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="loginEmail" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="loginPassword" class="form-input" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                    <p class="text-center mt-md">
                        <a href="#" onclick="showSignupForm(); return false;"
                            style="display: block; margin-bottom: var(--spacing-sm);">New User? Create Account</a>
                        <a href="#" onclick="showRoleSelection(); return false;"
                            style="font-size: 0.9em; color: var(--color-gray);">← Back to role selection</a>
                    </p>
                </form>
                <form id="signupForm" class="hidden">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="signupName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="signupEmail" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="tel" id="signupPhone" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="signupPassword" class="form-input" minlength="6" required>
                    </div>
                    <input type="hidden" id="signupRole" value="customer">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Sign Up</button>
                    <p class="text-center mt-md">
                        <a href="#" onclick="showRoleSelection(); return false;">← Back to login</a>
                    </p>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading-spinner">
        <div class="spinner"></div>
    </div>

    <!-- Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/customer.js"></script>

    <script>
        let currentFilter = 'all';

        document.addEventListener('DOMContentLoaded', () => {
            loadProducts();
            updateCartCount();
        });

        async function loadProducts() {
            try {
                let query = db.collection('products').where('status', '==', 'active');

                if (currentFilter !== 'all') {
                    query = query.where('category', '==', currentFilter);
                }

                const snapshot = await query.get();
                const grid = document.getElementById('products-grid');

                if (snapshot.empty) {
                    grid.innerHTML = '<div class="empty-state" style="grid-column: 1/-1;"><p>No products available in this category.</p></div>';
                    return;
                }

                grid.innerHTML = '';
                snapshot.forEach(doc => {
                    const product = doc.data();
                    const imageUrl = product.images && product.images[0] ? product.images[0] : 'assets/images/products/lavender-candle.png';

                    grid.innerHTML += `
            <div class="product-card" onclick="viewProduct('${doc.id}')">
              <img src="${imageUrl}" alt="${product.name}" class="product-card-image">
              <div class="product-card-body">
                <h3 class="product-card-title">${product.name}</h3>
                <p class="product-card-description">${product.description || ''}</p>
                <div class="product-card-price">${formatPrice(product.price)}</div>
                <button class="btn btn-primary" style="width: 100%;" onclick="event.stopPropagation(); addToCartFromProducts('${doc.id}', '${product.name}')">Add to Cart</button>
              </div>
            </div>
          `;
                });
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('products-grid').innerHTML = '<div class="empty-state" style="grid-column: 1/-1;"><p>Unable to load products. Please refresh the page.</p></div>';
            }
        }

        function filterProducts(category) {
            currentFilter = category;
            loadProducts();
        }

        function viewProduct(productId) {
            // Check if user is logged in before redirecting to detail, or redirect to a public detail page if it existed.
            // For now, let's redirect to the customer product detail which might require login, or just show the login modal.
            // window.location.href = `customer/product-detail.html?id=${productId}`; 
            requireLogin('shop'); // Simplified for now to prompt login
        }

        function addToCartFromProducts(productId, name) {
            openLoginModal(); // Require login to add to cart
        }

        // Profile dropdown toggle
        function toggleProfileMenu(event) {
            if (event) event.stopPropagation();
            const menu = document.getElementById('profileMenu');
            menu.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        window.addEventListener('click', function (event) {
            const menu = document.getElementById('profileMenu');
            if (menu && menu.classList.contains('show')) {
                if (!event.target.closest('.navbar-profile-dropdown')) {
                    menu.classList.remove('show');
                }
            }
        });

        function requireLogin(dest) {
            // For public page, just open login modal
            openLoginModal();
        }
    </script>
</body>

</html>